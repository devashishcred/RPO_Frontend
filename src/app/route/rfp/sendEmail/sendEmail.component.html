<div class="modal-custom-content" cdkDrag>
    <form novalidate name="sendMailForm"  #sendMailForm="ngForm">
        <div class="modal-header" cdkDragHandle>
            <!-- <button type="button" class="close close-icn">
                <span class="fa fa-minus-square-o"></span>
            </button> -->
            <button type="button" class="close close-icn" cdkDragHandle>
                <span class="fa fa-arrows"></span>
            </button>
            <h4 class="modal-title pull-left">Create Transmittal</h4>
        </div>
    
        <div class="modal-body pb0 pt15">
            <div class="row form-group">
                <div class="col-md-4">
                    <label class="block">From*</label>
                    <ng-select name="mailFromForm" [items]="empList" bindLabel="employeeName" bindValue="id" placeholder="From" [(ngModel)]="mailFrom" required #mailFromForm="ngModel">
                    </ng-select>
                    <div class="error-message pl0">
                        <div *ngIf="mailFromForm.errors && (mailFromForm.dirty || mailFromForm.touched)">
                        {{errorMsg.requireMailFrom}}
                        </div>
                    </div>    
                </div>
                <div class="col-md-4">
                    <label>To Company <span *ngIf="openFromCompany">*</span></label>
                    <ng-select name="mailToForm" [items]="companies" bindLabel="name" bindValue="id" placeholder="To Company" [(ngModel)]="mailTo" #mailToForm="ngModel" (change)="getContacts()" [required]="openFromCompany">
                    </ng-select>  
                    <div class="error-message pl0" *ngIf="openFromCompany">
                        <div *ngIf="mailToForm.errors && (mailToForm.dirty || mailToForm.touched)">
                        Company is required
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <label>To Contact*</label>
                    <ng-select name="mailAttentionForm" [items]="contacts" bindLabel="nameWithEmail" bindValue="id" placeholder="To Contact" [(ngModel)]="mailAttention" required #mailAttentionForm="ngModel" (click)='changeTheConatcts()' (change)="changeEmailBody()">
                    </ng-select>
                    <div class="error-message pl0">
                        <div *ngIf="mailAttentionForm.errors && (mailAttentionForm.dirty || mailAttentionForm.touched)">
                        {{errorMsg.requireMailAttention}}
                        </div>
                    </div>    
                </div>
            </div>
            
            <div class="row form-group">
                <div class="col-md-12" *ngIf="allContactsForCC?.length > 0">
                    <label>CC</label>
                    <angular2-multiselect [data]="allContactsForCC" name="selectCompType" [(ngModel)]="tmpContactId" [settings]="dropdownSettings">
                    </angular2-multiselect>
                </div>
            </div>
            <div class="row form-group">
                <div class="col-md-4">
                    <label>Transmittal Type*</label>
                    <ng-select name="mailTypeForm" [items]="this.mailTypes" bindLabel="name" bindValue="id" placeholder="Transmittal Type" [(ngModel)]="mailType" required #mailTypeForm="ngModel" (change)="setEmailBody()">
                    </ng-select>
                    <!-- <ng-select name="mailTypeForm" [items]="this.mailType == 9 ? allMailTypes : this.mailTypes" bindLabel="name" bindValue="id" placeholder="Transmittal Type" [(ngModel)]="mailType" required #mailTypeForm="ngModel" (change)="setEmailBody()">
                    </ng-select> -->
                    <div class="error-message pl0">
                        <div *ngIf="mailTypeForm.errors && (mailTypeForm.dirty || mailTypeForm.touched)">
                        {{errorMsg.requireMailType}}
                        </div>
                    </div>    
                </div>
                <div class="col-md-4">
                    <label>Sent Via*</label>
                    <ng-select name="mailViaForm" [items]="mailViaData" bindLabel="name" bindValue="id" placeholder="Sent Via" [(ngModel)]="mailVia"  required #mailViaForm="ngModel">
                    </ng-select>    
                    <div class="error-message pl0">
                        <div *ngIf="mailViaForm.errors && (mailViaForm.dirty || mailViaForm.touched)">
                        {{errorMsg.requireSentVia}}
                        </div>
                    </div>                    
                </div>
            </div>
    
            <p class="modify mb15">Note : Changing the selection in any of the above drop-downs will reset the Subject and Message.</p>
    
            <div class="row form-group">
                <div class="col-md-12">
                    <label>Subject*</label>
                    <input type="text" name="emailsubject" [(ngModel)]="subject" required #emailsubject="ngModel" class="form-control" placeholder="Subject">
                    <div class="error-message pl0">
                        <div *ngIf="emailsubject.errors && (emailsubject.dirty || emailsubject.touched)">
                        {{errorMsg.requireSubject}}
                        </div>
                    </div>   
                    <div class="error-message pl0">
                        <span  *ngIf="subject?.length > 200">
                            {{errorMsg.mailSubject}}
                      </span>
                    </div>   
                </div>
            </div>
            <div class="row form-group">
                <div class="col-md-12">
                    <label class="block">Message</label>
                    <ck-editor class="col-md-14" name="mailBody" [(ngModel)]="mailBody" [readonly]="false" [config]="configuration" debounce="100 "></ck-editor>
                </div>
            </div>
    
            <div class="row email-attach">
                <div class="col-sm-12">
                    <h4 class="blue-title mb5">
                        Attachments
                    </h4>
                        <div class="fl-upload">
                            <label for="contact-file-upload" class="upload-link rpo-file-upload mb0">Click to <span>Browse</span> to upload your files</label>
                            <input id="contact-file-upload" type="file" (change)="documentUpload($event)" class="rpo-file-upload" multiple />
                        </div>
                    <div>
                        <div> 
                            <a *ngIf="proposalPDFFile" class="link-blue" href="{{proposalPDFFile}}" target="_blank">Proposal PDF</a>
                        </div>
                        <div class="file-upload-wrap">
                        <div class="rpo-file-upload" *ngFor="let document of documents">
                            <span class="doc-name" *ngIf="!document.id" style="vertical-align: top;" tooltip="{{document.name}}" placement="top">{{document.name}}</span>
                            <a target="" class="remove" tooltip="Delete" placement="right" (click)="deleteDocument(document)">
                                    <i class="material-symbols-rounded">delete</i>
                            </a>
                            <a *ngIf="document.id" href="{{document.documentPath}}" class="pointer doc-name link-blue" style="vertical-align: top;" target="_blank" tooltip="{{document.name}}" placement="top" >{{document.name}}</a>
                        </div>
                    </div>
                    </div>
                    <div class="error-message" *ngIf="exceedFileSize">
                        <span> The total size of attachments exceed 23MB. Please remove few files to continue sending email.</span>
                    </div>
                </div>
            </div>
        </div>
    
        <div class="modal-footer">
            <button type="button" id="sndEmail" class="btn btn-blue pull-right" (click)="sendEMail();" [disabled]=" subject?.length > 200 || !sendMailForm.form.valid || exceedFileSize">Send</button>
            <button type="button" class="btn btn-white pull-right" (click)="modalRef.hide();loading=false">Cancel</button>
        </div>
    </form>
    <div class="lds-css" *ngIf="loading">
        <div class="lds-ripple">
            <div></div>
            <div></div>
        </div>
    </div>
</div>