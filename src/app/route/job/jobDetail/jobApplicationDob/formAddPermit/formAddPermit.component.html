<div class="modal-custom-content" cdkDrag>
  <form ngNativeValidate name="formWorkPermit" #formWorkPermit="ngForm">
    <div class="permit-content">
      <div class="modal-header" cdkDragHandle>
        <button type="button" class="close close-icn" cdkDragHandle>
          <span class="fa fa-arrows"></span>
        </button>
        <h4 class="modal-title pull-left">{{ jobPermit.id?'Edit':'Add'}} Work Permit</h4>
      </div>
      <div class="modal-body pb0">
        <div class="form-add-permit">
          <div class="row">
            <div class="col-sm-12">
              <div class="row form-group">
                <div class="col-sm-4">
                  <label for="Type">Application type</label>
                  <input type="text" name="applicationType" [(ngModel)]="jobPermit.jobApplicationTypeName" readonly="readonly" disabled="disabled"
                    class="form-control" />
                </div>
                <div class="col-sm-4">
                  <label for="Application">{{ isDep ? 'Tracking#':'Application#'}}</label>
                  <input type="text" name="idApplicationNumber" [(ngModel)]="jobPermit.applicationNumber" readonly="readonly" disabled="disabled"
                    class="form-control" />
                </div>
                <div class="col-sm-4" *ngIf="jobPermit.jobApplicationTypeName == 'FDNY'">
                  <label for="Permit">Permit#</label>
                  <input id="permitNumber" type="text" name="permitNumber" [(ngModel)]="jobPermit.permitNumber" 
                    class="form-control" />
                </div>
              </div>
              <div class="row form-group">
                <div class="col-sm-4">
                  <label for="Type">Work/Permit Type*</label>
                  <ng-select name="idJobWorkType" [items]="workPermit" bindLabel="description" bindValue="id" placeholder="Work/Permit Type"
                    [(ngModel)]="jobPermit.idJobWorkType" (change)="onChangeWorkPermitType($event)" #idJobWorkType="ngModel"
                    required>
                  </ng-select>
                  <div class="error-message pl0">
                    <div *ngIf="idJobWorkType.errors && (idJobWorkType.dirty || idJobWorkType.touched)">
                      {{errorMsg.requireJobWorkPermitType}}
                    </div>
                  </div>
                </div>
                <div class="col-sm-2">
                  <label for="code">Code</label>
                  <input type="text" placeholder="Code" disabled="disabled" readonly="readonly" name="code" class="form-control" [(ngModel)]="jobPermit.code"
                  />
                </div>
                <div class="col-sm-3">
                  <label for="cost">Estimated Cost</label>
                  <input type="text" placeholder="Estimated Cost" name="cost" #cost="ngModel" class="form-control" [(ngModel)]="jobPermit.estimatedCost"
                    maxlength="10" pattern="^[0-9.,]+$" />
                  <div class="error-message pl0">
                    <div *ngIf="cost.invalid && (cost.dirty || cost.touched)">
                      <div *ngIf="cost.errors.pattern">
                        {{errorMsg.onlyNumericCost}}
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-sm-3">
                  <label for="code">Permittee</label>
                  <input type="text" placeholder="Permittee" name="permittee" class="form-control" [(ngModel)]="jobPermit.permittee"
                  />
                </div>
              </div>
              <div class="row form-group date-row">
                <div class="col-sm-2">
                  <label for="filed">Filed on</label>
                  <div datetime-picker class="inner-addon right-addon input-group">
                    <i class="icon material-symbols-outlined clickable datepickerbutton">event</i>
                    <input id="fileddate" type="text" name="filed" class="form-control" [(ngModel)]="jobPermit.filed" />
                  </div>
                </div>
                <div class="col-sm-2">
                  <label for="issued">Issued on</label>
                  <div datetime-picker class="inner-addon right-addon input-group">
                    <i class="icon material-symbols-outlined clickable datepickerbutton">event</i>
                    <input id="issueddate" type="text" name="issued" class="form-control" [(ngModel)]="jobPermit.issued" />
                  </div>
                </div>
                <div class="col-sm-2">
                  <label for="expires">Expiry date</label>
                  <div datetime-picker class="inner-addon right-addon input-group">
                    <i class="icon material-symbols-outlined clickable datepickerbutton">event</i>
                    <input id="expiresdate" type="text" name="expires" class="form-control" [(ngModel)]="jobPermit.expires" />
                    <div class="error-message pl0">
                      <div *ngIf="jobPermit.expires && (getTheDateObject(jobPermit.issued) > getTheDateObject(jobPermit.expires))">
                        {{errorMsg.requiredExpiryDateSmaller}}
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-sm-2">
                  <label for="signOff">Signed-off on</label>
                  <div datetime-picker class="inner-addon right-addon input-group">
                    <i class="icon material-symbols-outlined clickable datepickerbutton">event</i>
                    <input id="signOffdate" type="text" name="signOff" class="form-control" [(ngModel)]="jobPermit.signedOff" />
                    <div class="error-message pl0">
                      <div *ngIf="(jobPermit.signedOff && getTheDateObject(jobPermit.filed) > getTheDateObject(jobPermit.signedOff))">
                        {{errorMsg.requiredSignOffDateSmaller}}
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-sm-2">
                  <label for="withdrawn">Withdrawn on</label>
                  <div datetime-picker class="inner-addon right-addon input-group">
                    <i class="icon material-symbols-outlined clickable datepickerbutton">event</i>
                    <input id="withdrawn" type="text" name="withdrawn" class="form-control" [(ngModel)]="jobPermit.withdrawn" />
                  </div>
                  <div class="error-message pl0">
                    <div *ngIf="(jobPermit.withdrawn && getTheDateObject(jobPermit.issued) > getTheDateObject(jobPermit.withdrawn))">
                      {{errorMsg.requiredWithdrawnDateSmaller}}
                    </div>
                  </div>
                </div>
              </div>
              <div class="row form-group date-row" *ngIf="jobPermit.code == 'TCO'">
                <div class="col-sm-3">
                  <label for="filed">Plumbing Signed-off</label>
                  <div datetime-picker class="inner-addon right-addon input-group">
                    <i class="icon material-symbols-outlined clickable datepickerbutton">event</i>
                    <input id="plumbingSignedOff" type="text" name="plumbingSignedOff" class="form-control" [(ngModel)]="jobPermit.plumbingSignedOff"
                    />
                  </div>
                </div>
                <div class="col-sm-3">
                  <label for="filed">Construction Signed-off</label>
                  <div datetime-picker class="inner-addon right-addon input-group">
                    <i class="icon material-symbols-outlined clickable datepickerbutton">event</i>
                    <input id="constructionSignedOff" type="text" name="constructionSignedOff" class="form-control" [(ngModel)]="jobPermit.constructionSignedOff"
                    />
                  </div>
                </div>
                <div class="col-sm-3">
                  <label for="filed">Final Elevator</label>
                  <div datetime-picker class="inner-addon right-addon input-group">
                    <i class="icon material-symbols-outlined clickable datepickerbutton">event</i>
                    <input id="finalElevator" type="text" name="finalElevator" class="form-control" [(ngModel)]="jobPermit.finalElevator" />
                  </div>
                </div>
                <div class="col-sm-3">
                  <label for="filed">Temp Elevator</label>
                  <div datetime-picker class="inner-addon right-addon input-group">
                    <i class="icon material-symbols-outlined clickable datepickerbutton">event</i>
                    <input id="tempElevator" type="text" name="tempElevator" class="form-control" [(ngModel)]="jobPermit.tempElevator" />
                  </div>
                </div>
              </div>
              <div class="row form-group response-row">
                <div [ngClass]="showPGL ? 'col-sm-3' : 'col-sm-4'" *ngIf="responsiblityList?.length > 0">
                  <label for="Type">Responsible Party</label>
                  <ng-select name="personRes" [items]="responsiblityList" bindLabel="itemName" bindValue="id" placeholder="Responsibility"
                    [(ngModel)]="jobPermit.idResponsibility" (change)="disablePersonResposible()">
                  </ng-select>
                </div>
                <div [ngClass]="showPGL ? 'col-sm-3' : 'col-sm-4'">
                  <label>
                    Person Responsible</label>
                  <ng-select name="idContactResponsible" [items]="jobContacts" bindLabel="contactName" bindValue="idContact" placeholder="Person Responsible"
                    [(ngModel)]="jobPermit.idContactResponsible" (change)="getCompany($event)" [disabled]="disablePerson">
                  </ng-select>
                </div>
                <div [ngClass]="showPGL ? 'col-sm-3' : 'col-sm-4'">
                  <label for="">Company Responsible</label>
                  <input class="form-control" disabled="disabled" type="text" name="companyResponsible" placeholder="Company Responsible" [(ngModel)]="jobPermit.companyResponsible"
                  />
                </div>
                <div class="col-sm-3 form-check" *ngIf="showPGL">
                    <label class="cust-checkbox checkbox form-check-label">
                      <input type="checkbox" class="form-check-input" name="isPGL" [(ngModel)]="jobPermit.isPGL"/>PGL
                      <i class="input-helper"></i>
                    </label>
                </div>
              </div>
              <div class="form-group">
                <div class="checkbox-inline form-check">
                  <label class="form-check-label" for="site">
                    <input class="form-check-input" id="site" name="site" type="checkbox" [(ngModel)]="jobPermit.hasSiteSafetyManager"> Site Safety Manager 
                    <i class="input-helper"></i>
                  </label>
                </div>
                <div class="checkbox-inline form-check">
                  <label class="form-check-label" for="Construction">
                    <input class="form-check-input" id="Construction" name="Construction" type="checkbox"  [(ngModel)]="jobPermit.hasSuperintendentofconstruction"> Superintendent of Construction 
                    <i class="input-helper"></i>
                  </label>
                </div>
                <div class="checkbox-inline form-check">
                  <label class="form-check-label" for="Coordinator">
                    <input class="form-check-input" id="Coordinator" name="Coordinator" type="checkbox"  [(ngModel)]="jobPermit.hasSiteSafetyCoordinator"> Site Safety Coordinator 
                    <i class="input-helper"></i>
                  </label>
                </div>
              </div>

              <div class="row" style="margin-top: 1rem;">
                <div class="col-sm-12">
                  <label for="description">Work Description</label>
                  <textarea class="form-control" rows="3" placeholder="" name="desc" [(ngModel)]="jobPermit.workDescription"></textarea>
                </div>
              </div>
  
  
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer text-right">
        <div class="col-sm-7 text-left">
          <div class="modify" *ngIf="jobPermit.lastModifiedDate && jobPermit.lastModifiedDate">Last modified by {{jobPermit.lastModifiedByEmployeeName ? jobPermit.lastModifiedByEmployeeName : jobPermit.createdByEmployeeName}} on {{jobPermit.lastModifiedDate ?( jobPermit.lastModifiedDate | date :'MM/dd/yyyy, h:mm a')  : (jobPermit.createdDate | date :'MM/dd/yyyy, h:mm a')}}</div>
        </div>
        <button type="button" class="btn btn-white" (click)="modalRef.hide()">Cancel</button>
        <button type="submit" class="btn btn-blue" [disabled]="!formWorkPermit.form.valid || jobPermit.expires && (getTheDateObject(jobPermit.issued) > getTheDateObject(jobPermit.expires))
          || (jobPermit.signedOff && getTheDateObject(jobPermit.filed) > getTheDateObject(jobPermit.signedOff)) ||
          (jobPermit.withdrawn && getTheDateObject(jobPermit.issued) > getTheDateObject(jobPermit.withdrawn))" (click)="savePermit()">{{jobPermit.id?'Update':'Save'}}</button>
      </div>
    </div>
    <div class="lds-css" *ngIf="loading">
      <div class="lds-ripple">
        <div></div>
        <div></div>
      </div>
    </div>
  </form>
</div>